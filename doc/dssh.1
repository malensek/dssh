.\" Automatically generated by Pandoc 1.16.0.2
.\"
.TH "DSSH" "1" "February 2016" "" ""
.hy
.SH NAME
.PP
\f[B]dssh\f[] \- ssh for clusters
.SH SYNOPSIS
.PP
\f[B]dssh\f[] [\-aAcjpqy] [\-f\ host_file...] [\-i\ id_file]
[\-l\ host_list...] [\-o\ ssh_opts] [\-u\ username] [\-s\ timeout]
[\-t\ max_threads] \f[I]command\f[]
.SH DESCRIPTION
.PP
\f[B]dssh\f[] is a simple utility designed for executing commands across
several hosts via ssh.
Commands may be executed in parallel or sequentially, with a variety of
formatting and output options.
.PP
Remote hosts for command execution are specified by file(s), lists on
the command line, the DSSH_HOSTS environment variable, or hostnames
piped from standard input.
Whitespace is used to distinguish between hosts.
A connection is made to each host via ssh and the user\-defined
\f[I]command\f[] is executed.
.PP
While the basic functionality provided by \f[B]dssh\f[] can be mimicked
with a few lines of shell script, additional features such as limiting
the number of active threads, output collection/formatting, and
colorization simplify the advanced cases.
.SH OPTIONS
.TP
.B \-a
Enable \[aq]active\[aq] printing of ssh output instead of buffering it
until the command completes.
Since this may result in interleaved outputs from multiple hosts, the
remote hostname is prepended to each output line.
.RS
.RE
.TP
.B \-A
Enable active printing with abbreviated hostnames, where only the first
part of the name is shown (up to the first \[aq].\[aq] character).
Useful for long hostnames.
.RS
.RE
.TP
.B \-c
Enable colorized output.
Automatically disabled if stdout is not a terminal.
.RS
.RE
.TP
.B \-e
Re\-enable disabled hosts (entries prefixed with a # character)
.RS
.RE
.TP
.B \-f \f[I]host_file\f[]
Adds plain\-text file(s) of machine hostnames to the master host list.
Hostnames must be separated by whitespace.
.RS
.RE
.TP
.B \-i \f[I]id_file\f[]
Selects an identity file containing a private key to use for
authentication.
.RS
.RE
.TP
.B \-j
Enables \f[I]job mode\f[] (alias for \-Apy).
This mode is useful for executing long\-running processes on a
collection of remote machines, as any output from the processes will be
printed immediately and job control will be enabled (i.e., pressing ^C
will terminate remote jobs, if supported).
.RS
.RE
.TP
.B \-l \f[I]host_list\f[]
Adds a list of hostnames specified as a string to the master host list.
Hostnames must be separated by whitespace.
.RS
.RE
.TP
.B \-o \f[I]ssh_opts\f[]
Adds options to be passed through to the ssh command line.
Options should be quoted to avoid confusing the dssh option parser.
.RS
.RE
.TP
.B \-p
Executes remote commands in parallel, with each remote connection
launched on a separate thread (no thread limit).
By default, output is buffered and printed after the command completes
unless active printing (\f[B]\-a\f[]) is used.
.RS
.RE
.TP
.B \-q
Quiet output mode; silences extra output, such as hostnames and extra
newlines.
Error messages will still be displayed.
.RS
.RE
.TP
.B \-u \f[I]username\f[]
Authenticate using a different name than the current user.
.RS
.RE
.TP
.B \-s \f[I]timeout\f[]
Configures how long to wait (in seconds) before timing out remote
connections.
.RS
.RE
.TP
.B \-t \f[I]num_threads\f[]
Limits the number of threads used during parallel execution (implies
\f[B]\-p\f[]).
.RS
.RE
.TP
.B \-y
Allocates a pseudoterminal (PTY).
This allows remote screen\-based applications to run (such as top(1)),
and also enables job control.
Care should be taken when redirecting output to files, and the
\f[B]\-q\f[] (quiet) option may be useful if output becomes garbled.
.RS
.RE
.SH EXIT STATUS
.PP
Nonzero if errors occurred.
.SH ENVIRONMENT
.PP
The \f[I]DSSH_HOSTS\f[] environment variable affects the starting host
list.
Additional hosts may be added using the usual flags listed above.
.SH USAGE EXAMPLES
.PP
Retrieve uptime information for several hosts in \f[I]hosts.txt\f[]:
.IP
.nf
\f[C]
dssh\ \-f\ hosts.txt\ \[aq]uptime\[aq]
\f[]
.fi
.PP
Retrieve uptime information as above, but in parallel.
To make errors more visible, we enable colorization:
.IP
.nf
\f[C]
dssh\ \-p\ \-c\ \-f\ hosts.txt\ \[aq]uptime\[aq]
\f[]
.fi
.PP
Sort our list of hostnames, and then determine who is logged in to each
machine.
To avoid opening too many connections at once, limit the number of
active threads to two:
.IP
.nf
\f[C]
sort\ hosts.txt\ |\ dssh\ \-t\ 2\ \[aq]who\[aq]
\f[]
.fi
.PP
Check the contents of /tmp on our cluster of cloud instances using
different credentials, and time out connections after 1 second if the
remote host doesn\[aq]t respond:
.IP
.nf
\f[C]
dssh\ \-u\ ec2\-user\ \-i\ credentials.pem.txt\ \-s\ 1\ \[aq]ls\ /tmp\[aq]
\f[]
.fi
.PP
Run a distributed application on a list of hosts and print output to the
local terminal.
Also enable job control so when we terminate dssh with ^C all the remote
processes are terminated as well:
.IP
.nf
\f[C]
dssh\ \-A\ \-p\ \-y\ \-l\ "host1\ host2\ host3"\ \[aq]java\ \-jar\ ./myapp.jar\[aq]
\f[]
.fi
.PP
Perform the same operation as above, but use the \f[B]\-j\f[] alias for
\-Apy:
.IP
.nf
\f[C]
dssh\ \-j\ \-l\ "host1\ host2\ host3"\ \[aq]java\ \-jar\ ./myapp.jar\[aq]
\f[]
.fi
.PP
Determine whether Jane is logged in on a set of hosts that run SSH on a
non\-standard port, using IPv6:
.IP
.nf
\f[C]
dssh\ \-pf\ hosts5000v6.txt\ \-o\[aq]\-6\ \-oPort=5000\[aq]\ \[aq]w\[aq]\ |\ grep\ \-i\ jane
\f[]
.fi
.PP
Print out hosts that do not have a particular directory in their file
system (note we suppress extra output with \f[B]\-q\f[]):
.IP
.nf
\f[C]
dssh\ \-q\ \-pf\ hosts.txt\ \[aq]ls\ \-d\ /data/mydir\ &>\ /dev/null\ ||\ hostname\[aq]
\f[]
.fi
.SH WEBSITE
.PP
http://sigpipe.io/dssh
